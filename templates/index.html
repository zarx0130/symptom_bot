<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symptom Checker</title>
    <style>
        /* [All previous CSS styles remain exactly the same] */
        .diagnosis-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .diagnosis-title {
            font-weight: bold;
            color: #a02d2d;
            margin-bottom: 10px;
        }
        .diagnosis-detail {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <!-- [Previous HTML structure remains the same until the script] -->

    <script>
        let allPossibleIllnesses = [];
        let shownIllnessCount = 0;

        function sendMessage() {
            const input = document.getElementById('symptoms');
            const message = input.value.trim();
            if (message === '') return;

            allPossibleIllnesses = [];
            shownIllnessCount = 0;

            const chatMessages = document.getElementById('chat-messages');
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.innerHTML = `<p>${message}</p>`;
            chatMessages.appendChild(userMessage);

            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'message bot typing-indicator';
            typingIndicator.innerHTML = `
                <span></span>
                <span></span>
                <span></span>
            `;
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ symptoms: message }),
            })
            .then(response => response.json())
            .then(data => {
                setTimeout(() => {
                    chatMessages.removeChild(typingIndicator);

                    if (data.error) {
                        const errorMessage = document.createElement('div');
                        errorMessage.className = 'message bot';
                        errorMessage.innerHTML = `<p>${data.error}</p>`;
                        chatMessages.appendChild(errorMessage);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        return;
                    }

                    // Display primary diagnosis
                    if (data.primary) {
                        const primaryMsg = document.createElement('div');
                        primaryMsg.className = 'message bot';
                        primaryMsg.innerHTML = createDiagnosisCard(data.primary, true);
                        chatMessages.appendChild(primaryMsg);
                    }

                    // Store secondary diagnoses if they exist
                    if (data.secondary && data.secondary.length > 0) {
                        allPossibleIllnesses = data.secondary;
                        
                        const promptMessage = document.createElement('div');
                        promptMessage.className = 'message bot';
                        promptMessage.innerHTML = `
                            <p>Would you like to see other possible conditions?</p>
                            <button class="show-more-btn" onclick="showMoreIllnesses()">Show More Options</button>
                        `;
                        chatMessages.appendChild(promptMessage);
                    }
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500);
            })
            .catch(error => {
                console.error('Error:', error);
                setTimeout(() => {
                    chatMessages.removeChild(typingIndicator);
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'message bot';
                    errorMessage.innerHTML = '<p>Sorry, there was an error processing your request.</p>';
                    chatMessages.appendChild(errorMessage);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1500);
            });
        }

        function createDiagnosisCard(illness, isPrimary) {
            return `
                <div class="diagnosis-card">
                    <div class="diagnosis-title">
                        ${isPrimary ? 'Most Likely Diagnosis' : 'Possible Diagnosis'} 
                        (matching ${illness.count} symptoms)
                    </div>
                    <div class="diagnosis-detail"><strong>Condition:</strong> ${illness.name}</div>
                    <div class="diagnosis-detail"><strong>Symptoms:</strong> ${illness.symptoms}</div>
                    <div class="diagnosis-detail"><strong>Severity:</strong> ${illness.severity}</div>
                    <div class="diagnosis-detail"><strong>Contagious:</strong> ${illness.contagious}</div>
                    <div class="diagnosis-detail"><strong>Treatment:</strong> ${illness.treatment}</div>
                    <div class="diagnosis-detail"><strong>Notes:</strong> ${illness.notes}</div>
                </div>
            `;
        }

        function showMoreIllnesses() {
            const chatMessages = document.getElementById('chat-messages');
            const lastMessage = chatMessages.lastChild;
            
            if (lastMessage.querySelector('.show-more-btn')) {
                chatMessages.removeChild(lastMessage);
            }
            
            const illnessesToShow = allPossibleIllnesses.slice(shownIllnessCount, shownIllnessCount + 3);
            shownIllnessCount += illnessesToShow.length;
            
            illnessesToShow.forEach(illness => {
                const illnessMessage = document.createElement('div');
                illnessMessage.className = 'message bot';
                illnessMessage.innerHTML = createDiagnosisCard(illness, false);
                chatMessages.appendChild(illnessMessage);
            });
            
            if (shownIllnessCount < allPossibleIllnesses.length) {
                const showMoreBtn = document.createElement('div');
                showMoreBtn.className = 'message bot';
                showMoreBtn.innerHTML = `
                    <button class="show-more-btn" onclick="showMoreIllnesses()">Show More Options</button>
                `;
                chatMessages.appendChild(showMoreBtn);
            }
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        document.getElementById('symptoms').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>